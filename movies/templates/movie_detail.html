{% extends 'base.html' %}

{% block title %}
    {{ movie.title }} - Movie Details
{% endblock %}

{% block content %}
    <div class="container mt-4">
        <!-- Movie Detail Card -->
        <div class="card mb-4 border-light shadow-lg rounded">
            <div class="row g-0">
                <!-- Movie Poster -->
                <div class="col-md-4">
                    {% if movie.get_poster_url %}
                        <img src="{{ movie.get_poster_url }}" class="img-fluid rounded-start" alt="{{ movie.title }}">
                    {% else %}
                        <img src="https://via.placeholder.com/300x450?text=No+Image" class="img-fluid rounded-start"
                             alt="No Image Available">
                    {% endif %}
                </div>
                <!-- Movie Details -->
                <div class="col-md-8">
                    <div class="card-body">
                        <h1 class="card-title mb-3">{{ movie.title }}</h1>
                        <div class="mb-3">
                            <span class="badge bg-primary text-light">Release Year: {{ movie.release_year }}</span>
                        </div>
                        <p class="card-text mb-3"><strong>Overview:</strong> {{ movie.overview|linebreaksbr }}</p>
                        {% if movie.tagline %}
                            <p class="card-text mb-3"><strong>Tagline:</strong> <em>{{ movie.tagline }}</em></p>
                        {% endif %}
                        <p class="card-text mb-3"><strong>Price:</strong> <span
                                class="text-success">${{ movie.price }}</span></p>
                        <p class="card-text mb-3"><strong>Genres:</strong>
                            {% for genre in movie.genres.all %}
                                <span class="badge bg-secondary">{{ genre.name }}</span>{% if not forloop.last %},
                            {% endif %}
                            {% endfor %}
                        </p>
                        <p class="card-text mb-3"><strong>Number of Votes:</strong> {{ movie.num_votes }}</p>
                        <p class="card-text mb-3"><strong>Average Rating:</strong>
                            <span class="text-warning">{{ movie.average_rating|floatformat:2 }}</span> <i
                                    class="bi bi-star-fill"></i>
                        </p>

                        <!-- Include the vote section -->

                        <p class="card-text mb-3"><strong>Popularity:</strong> {{ movie.popularity }}</p>
                        <p class="card-text mb-3"><strong>IMDb ID:</strong>
                            <a href="https://www.imdb.com/title/{{ movie.imdb_id }}" target="_blank"
                               class="text-decoration-none">{{ movie.imdb_id }}</a>
                        </p>

                        <!-- Cast Information -->
                        <h3 class="mt-4">Cast</h3>
                        {% if movie.cast_set.exists %}
                            <div class="row row-cols-1 row-cols-md-2 g-3">
                                {% for cast in movie.cast_set.all %}
                                    <div class="col">
                                        <div class="card h-100 border-0">
                                            <div class="card-body d-flex align-items-start justify-content-between">
                                                <div>
                                                    <h5 class="card-title">{{ cast.person.name }}</h5>
                                                    <p class="card-text text-muted mb-0">{{ cast.role }}</p>
                                                    {% if cast.character_name %}
                                                        <p class="card-text text-muted">as {{ cast.character_name }}</p>
                                                    {% endif %}
                                                </div>
                                                {% if cast.person.imdb_id %}
                                                    <a href="https://www.imdb.com/name/{{ cast.person.imdb_id }}"
                                                       target="_blank"
                                                       class="text-decoration-none">
                                                        <i class="bi bi-imdb"></i>
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-muted">No cast information available.</p>
                        {% endif %}

                        <a href="{% url 'home' %}" class="btn btn-primary mt-4">Back to List</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Icons -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
{% endblock %}
